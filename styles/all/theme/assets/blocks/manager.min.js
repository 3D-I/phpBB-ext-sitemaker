!function(t,e,i,n){"use strict";var o="",a=!1,l=!1,s=!1,r={},c={},d={},u={},f={},p={},g={},h={},b={},v={},m={},k={},x={},y={},C={},_={},w={},j={},U={},S={},D=!1,z={},O={},T={},A=function(t){var e=t.length,i=t.parent().data("columns")!==n?t.parent().data("columns")<=5?t.parent().data("columns"):5:3,o=e%i,a=e-o;if(i>=e)i=e;else if(t.parent().hasClass("equal")){if(o>0&&i>3)for(var l=1;o>l;l++)if(e%(i-l)===0){i-=l;break}a=e,o=0}if(N(t),a>0&&t.slice(0,a).addClass("grid__col grid__col--1-of-"+i),o){var s=1;2>o&&(s=5,o=5),t.slice(a,e).addClass("grid__col grid__col--"+s+"-of-"+o)}},N=function(t){t.removeClass(function(){var t=this.className.match(/grid__col+(\S+)?/gi);return t?t.join(" "):""})},J=function(){r.addClass("show-position"),d.removeClass("empty-position").siblings(".grid__col").removeClass("lastUnit")},P=function(){r.removeClass("show-position"),d=t('.block-position:not(:has(".block"))').addClass("empty-position").each(function(e,i){t(i).siblings(".grid__col").last().addClass("lastUnit")})},B=function(e,i,n){t(n).removeAttr("role aria-disabled data-block class style").addClass("block").html('<div class="ui-state-highlight sm-block-spacing sortable" style="padding: 5px"><i class="fa fa-spinner fa-2x fa-spin"></i> '+U.ajaxLoading+"</div>");var o={block:t.trim(i),weight:n.parent().find(".block").index(n),route:S.route,ext:S.ext,position:e};t.getJSON(S.ajaxUrl+"/blocks/add",o,function(e){if(l=!1,""===e.id)return void t(n).remove();var i=f.render(e);t(n).attr("id","block-"+e.id).html(i).children().not(".block-controls").show("scale",{percent:100},1e3),Y(),Z()})},E=function(e){t.getJSON(S.ajaxUrl+"/blocks/edit",{id:e.attr("id").substring(6)},function(e){_=e,e.form&&(b.html(e.form),b.find("#block-settings").tabs(),b.find("select[data-togglable-settings]").each(function(){var e=t(this);e.change(function(){z.toggleSelectSettings(e)}),z.toggleSelectSettings(e)}),b.dialog({buttons:x}).dialog("option","title",U.edit+" - "+e.title).dialog("open"))})},Q=function(e){var i=t("#edit_form"),n=b.dialog("widget").find("#update-similar:checked").length;t.getJSON(S.ajaxUrl+"/blocks/save?route="+S.route+"&id="+e.attr("id").substring(6)+"&similar="+n+"&"+i.serialize(),function(e){b.dialog("close"),t.each(e,function(e,i){t("#block-"+i.id).html(f.render(i))})})},q=function(e){return e.id===n?!1:void t.post(S.ajaxUrl+"/blocks/update?route="+S.route,e,function(t){a===!0&&H(t.title)},"json")},I=function(e){e.id!==n&&t.getJSON(S.ajaxUrl+"/blocks/custom",e,function(t){"function"==typeof z.ajaxCallbacks[t.callback]&&z.ajaxCallbacks[t.callback].call(n,t)})},L=function(e){t.post(S.ajaxUrl+"/blocks/set_default?route="+(e===!0?S.route:""))},M=function(e){t.post(S.ajaxUrl+"/blocks/set_startpage",t.param(e))},V=function(e){t.post(S.ajaxUrl+"/blocks/layout_settings?route="+S.route+"&ext="+S.ext,e.serialize())},W=function(e){var i=t(".block-position");t.getJSON(S.ajaxUrl+"/blocks/copy_layout?route="+S.route+"&ext="+S.ext+"&"+t.param(e),function(e){0!==e.data.length&&(J(),i.empty(),t.each(e.data,function(e,i){var n=t("#pos-"+e);t.each(i,function(t,e){var i=f.render(e);n.append('<div id="block-'+e.id+'" class="unit size1of1 block"></div>'),n.find("#block-"+e.id).html(i)}),n.hasClass("horizontal")&&A(n.find(".block"))}),P())})},F=function(){var e=[];t(".block-position").each(function(){var i=0,o=t(this).attr("id");t(this).find(".block").each(function(a,l){var s=t(l).attr("id");o!==n&&s!==n&&(e.push({bid:s.substring(6),position:o.substring(4),weight:i}),i++)})}),t.post(S.ajaxUrl+"/blocks/save_layout",{route:S.route,blocks:e},function(){j.button("disable"),l=!1})},G=function(t){return a===!0?void g.children(":input").trigger("blur"):(a=!0,o=t.removeClass("editable").text(),void g.show().appendTo(t.text("")).children(":input").val(o).focus().select().end())},H=function(e){var i=g.parent();a=!1,o="",i.addClass("editable").text(e),g.hide().appendTo(t("body"))},K=function(e){if(a!==!1){var i=t(e).parentsUntil(".block").parent().attr("id").substring("6"),n=t(e).val();return i&&n!==o?q({id:i,field:"title",title:n}):H(o),!1}},R=function(){var e=jQuery.extend(!0,{},_),i=b.find("#edit_form").serializeArray();t.each(i,function(){e[this.name]=this.value}),C.html(f.render(e))},X=function(){C.html(f.render(_))},Y=function(){t(".block-icon").iconPicker({onSelect:function(t,e,i){var n=t.parentsUntil(".block").parent().attr("id").substring("6");q({id:n,icon:i})}})},Z=function(){O.init({selector:"div.editable-block",inline:!0,image_advtab:!0,plugins:["advlist autolink lists link image imagetools charmap anchor","visualblocks code hr","media table contextmenu paste"],valid_elements:"*[*]",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | hr link image | code",setup:function(e){var i="",n="";e.on("blur",function(){var o=e.getContent({format:"raw"});if(e.getContent().length>0){var a=t("#"+e.id).data("raw",o).data();o!==n&&o!==U.placeholder?(a.id=e.id.substring(13),a.content=o,I(a)):e.setContent(i)}else e.setContent(i?i:U.placeholder)}),e.on("init",function(){0===e.getContent().length&&e.setContent(U.placeholder)}),e.on("focus",function(){n=t("#"+e.id).data("raw"),i=e.getContent({format:"raw"}),e.setContent(n)})}})},$=function(t){t&&(w.html(t),w.fadeIn().delay(3e3).fadeOut())},tt=function(t,e){t?$('<span><i class="fa fa-info-circle fa-blue fa-lg"></i> '+U.hidingBlocks+"</span>"):e.length&&$('<span><i class="fa fa-info-circle fa-blue fa-lg"></i> '+U.hidingPos+": <strong>"+e.join(", ")+"</strong></span>")};t(i).ready(function(){D=e.editMode||!1,U=e.lang||{},z=e.phpbb||{},O=e.tinymce||{},T=e.twig||{},S=e.config||{ajaxUrl:"",boardUrl:"",route:"",ext:"",style:""};var i="",o={},a={},_=!1,q=t("#admin-bar").delay(300).slideDown().find("#admin-control").click(function(){return D?(t(this).prev().toggle(),!1):void 0}).find("i");if(D){g=t('<form class="inline-form"><input type="text" class="inline-edit" value="" /></form>').hide().appendTo(t("body")),t("#add-block-panel").find(".sitemaker-block").draggable({scroll:!0,revert:!0,addClasses:!1,opacity:.7,helper:"clone",connectToSortable:".block-position",start:function(){J()},stop:function(){e.setTimeout(function(){l===!1&&P()},600)}});var I;a=t("#ex_positions"),r=t(".block-position").addClass("block-receiver").sortable({placeholder:"ui-state-highlight grid__col sm-block-spacing block sortable placeholder",forcePlaceholderSize:!1,items:".block",cancel:".editable-block, .inline-edit",delay:150,dropOnEmpty:!0,tolerance:"pointer",connectWith:".block-position",cursorAt:{top:-10,left:-10},start:function(e,i){p=t(i.item).addClass("dragging").parent(".horizontal"),J(),r.sortable("refresh")},over:function(t,e){I=e.placeholder.parent(".horizontal").children(".block").addClass("sortable")},out:function(){I.removeClass("sortable")},update:function(e,i){if(l=!0,t(i.item).attr("id")===n){var a=t(this).attr("id").substring("4"),s=t(i.item).attr("data-block"),r=t(this).find('div[data-block="'+s+'"]');o.trigger("click"),B(a,s,r)}else j.button("enable");var c=t(i.item).removeAttr("style").parent(".horizontal").children(".block"),d=t(i.item);d.parent().removeClass("empty-position"),N(d),c.length>0&&A(c),p.attr("id")!==t(i.item).parent(".horizontal").attr("id")&&A(p.find(".block").removeClass("sortable"))},stop:function(e,i){t(i.item).removeClass("dragging sortable").removeAttr("style"),P(),t("body").trigger("layoutChanged")}}).on("click",".block-title",function(){G(t(this))}).on("submit",".inline-form",function(e){e.preventDefault(),t(this).find(".inline-edit").trigger("blur")}).on("focusout",".inline-edit",function(){K(t(this))}).on("click",".edit-block",function(e){e.preventDefault(),C=t(this).parentsUntil(".block").parent(),E(C)}).on("click",".delete-block",function(e){e.preventDefault(),C=t(this).parentsUntil(".block").parent(),h.dialog({buttons:k}).dialog("open")}).each(function(e,i){var n=t(i).attr("id").substring("4");0===a.find("option[value="+n+"]").length&&a.append('<option value="'+n+'">'+n+"</option>")}),z.addAjaxCallback("previewCustomBlock",function(e){t("#block-editor-"+e.id).html(e.content.replace("./../../",""))}),j=t("#toggle-edit").button().click(function(){}).parent().next().children("a").button({disabled:!0}).click(function(t){t.preventDefault(),F()}),t(".has-dropdown").click(function(e){e.preventDefault(),t(this).parentsUntil("ul").parent().find(".dropped").not(t(this)).removeClass("dropped").next().hide(),o=t(this).toggleClass("dropped"),o.next().toggle()}).next().mouseleave(function(){}),t("#admin-options").show(100,function(){var e=t.grep(a.val(),function(t){return t.length});tt(_,e)}),w=t("#ajax-message"),c=t("#main-content"),u=t("#pos-subcontent"),d=t('.block-position:not(:has(".block"))').addClass("empty-position"),f=T({data:t.trim(t("#block-template-container").html())}),t.ajaxSetup({beforeSend:function(t,e){q.addClass("fa-spinner fa-green fa-spin fa-lg fa-pulse"),e.url+=(e.url.indexOf("?")<0?"?":"&")+"style="+S.style},complete:function(){q.delay(1e3).removeClass("fa-spinner fa-green fa-spin fa-lg fa-pulse")},success:function(e){var i=e.message?e.message:e.errors;i&&(t("#loading").hide(),$(i))},error:function(){$(U.ajaxError)}}),x[U.edit]=function(){Q(C)},x[U.cancel]=function(){X(),t(this).dialog("close")},k[U.remove]=function(){var e=C.parent(".horizontal");C.hide("scale",{percent:5},3e3).parent().remove();var i=e.find(".block");i.length>0&&A(i),P(),j.button("enable"),t(this).dialog("close")},k[U.cancel]=function(){t(this).dialog("close")};var H={autoOpen:!1,modal:!0,width:"auto",show:"slide",hide:"slide"};h=t("#dialog-confirm").dialog(H),y[U.deleteAll]=function(){t(this).dialog("close"),t(".block-position").empty(),P(),j.button("enable"),l=!0},y[U.cancel]=function(){t(this).dialog("close")};var et=t("#dialog-delete-all").dialog(H),it=t("#delete-blocks").button().click(function(t){t.preventDefault(),et.dialog({buttons:y}).dialog("open")});m[U.copy]=function(){t(this).dialog("close"),W(i),it.parent().show()},m[U.cancel]=function(){t(this).dialog("close")},v=t("#dialog-copy").dialog(H),t("#copy-form").find(".layout-action").button().click(function(e){e.preventDefault(),i=t(this).parent().parent().serializeArray();var n=i[0].value,a=i[1].value,l=t(this).data("action");if(""===n||n===S.route&&a===S.style)return!1;if("copy"===l)o.trigger("click"),v.dialog({buttons:m}).dialog("open");else{var s="";s+=("/"===n.substring(0,1)?S.ajaxUrl:S.boardUrl+"/")+n,s+=(s.indexOf("?")>=0?"&":"?")+"style="+a+"&edit_mode=1",location.href=s}}),H.open=function(){if(s===!1){var e=t(this).dialog("widget").find(".ui-dialog-buttonpane");s=!0,t('<label class="dialog-check-button"><input id="update-similar" type="checkbox" checked="checked" />'+U.updateSimilar+"</label>").prependTo(e)}},b=t("#dialog-edit").dialog(H).on("click",".block-class-actions",function(e){switch(e.preventDefault(),t(this).data("action")){case"clear":b.find("#block_class").val("").change();break;case"toggle":b.find("#css-class-options").slideToggle()}}).on("click",".class-cat",function(e){var i=t(this).attr("href"),n=t("#classes-scroller");n.animate({scrollTop:n.scrollTop()+t(i).position().top-200},1e3),e.preventDefault()}).on("click",".transform",function(e){var i=b.find("#block_class"),n=i.val();n=(n?n+" ":"")+t(this).text(),i.val(n).change(),e.preventDefault()}).on("change",".block-preview",function(){R()}),t(".default-layout").button().click(function(e){var i=t(this).data("set");L(i),e.preventDefault(),i===!0?(t(this).parent().hide().next().hide().next().show(),it.parent().hide()):(t(this).parent().hide().prev().hide().prev().show(),it.parent().show())}),t(".sm-startpage").button().click(function(e){e.preventDefault();var i={};"set-startpage"===t(this).attr("id")?(t(this).parent().hide().next().show(),i={controller:t(this).data("controller"),method:t(this).data("method"),params:t(this).data("params")},M(i)):(t(this).parent().hide().prev().show(),M(i))}),_=t("#route-settings").submit(function(e){V(t(this)),e.preventDefault()}).find("#hide_blocks").is(":checked"),e.onbeforeunload=function(t){return l===!0?(t=t||e.event,t&&(t.returnValue=U.leaveConfirm),U.leaveConfirm):void 0},Y(),Z()}})}(jQuery,window,document);
//# sourceMappingURL=../../../../all/theme/assets/blocks/manager.min.js.map